files:
  "/etc/docker-compose.yml":
    mode: "000644"
    owner: root
    group: root
    content: |
      version: '3'
      services:
        prometheus:
          image: prom/prometheus
          container_name: prometheus
          ports:
            - "9090:9090"
          volumes:
            - /etc/prometheus/prometheus.yml:/etc/prometheus/prometheus.yml

        grafana:
          image: grafana/grafana
          container_name: grafana
          ports:
            - "3000:3000"

container_commands:
  01_copy_prometheus_yml:
    command: "cp /opt/elasticbeanstalk/deployment/app_source/prometheus.yml /etc/prometheus.yml"
  02_docker_compose_up:
    command: "docker-compose -f /etc/docker-compose.yml up -d"