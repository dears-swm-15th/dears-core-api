files:
  "/opt/elasticbeanstalk/hooks/appdeploy/pre/01_set_env.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      for var in $(/opt/elasticbeanstalk/bin/get-config environment | jq -r 'to_entries|map("\(.key)=\(.value|tostring)")|.[]'); do
        export $var
      done

  "/etc/fstab":
    mode: "000644"
    owner: root
    group: root
    content: |
      # <file system> <mount point>   <type>  <options>       <dump>  <pass>
      UUID=xxxx-xxxx-xxxx-xxxx  /               ext4    errors=remount-ro 0       1
      /swapfile   none    swap    sw      0       0

commands:
  01_create_swapfile:
    command: |
      if [ ! -f /swapfile ]; then
        fallocate -l 4G /swapfile
        chmod 600 /swapfile
        mkswap /swapfile
        swapon /swapfile
      fi

  02_adjust_swappiness:
    command: |
      sysctl vm.swappiness=10
    ignoreErrors: true

